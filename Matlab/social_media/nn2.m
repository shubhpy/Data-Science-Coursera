function [Y,Xf,Af] = nn2(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 28-Feb-2016 12:14:06.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx7 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx1 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [-36191068;-35419974;-36543194;-4947337;-35419902.01212;-136440;-979.35789470637];
x1_step1_gain = [2.74976696624359e-08;5.46714184876759e-08;5.47283042169309e-08;4.04180150084505e-07;5.64638659615402e-08;1.45555969189013e-05;0.00150496835343856];
x1_step1_ymin = -1;

% Layer 1
b1 = [-2.006567846810249;-1.5487440738435139;-0.97311513433252539;-0.91124674680979012;-0.068537247088323219;0.081334268310734203;-0.54385557821453034;1.1889916439386625;-1.5072423073164107;-1.9034324646206968];
IW1_1 = [1.5272367527971964 0.64703288453953189 -0.3150620862930138 1.0351279260162274 0.48155068331149364 -0.47515287353269825 1.6709395724397837;0.85529933324113949 -1.2625167548345821 -0.18766217995155116 1.0580311944508143 -0.28314142886415639 -0.58744086855140432 -0.10648957788757485;0.93659906706391494 -0.55948965755375435 -1.0462377934282598 -0.81267547167514098 0.86662904919926453 0.2352355277402495 -0.59218522338995916;0.4739938863029563 -1.1116437727138868 0.65571622843500776 -0.48072764607939827 0.87942009605336735 -0.69148633024487549 0.61612899789345876;2.4927082529074744 0.33970997711729312 1.0411507320683691 -0.63902576540112122 -0.62275338265228053 0.25805160019917056 -0.41288937335032821;1.2520162594769948 -0.005876484303094163 -0.6884597286797286 -0.84738166608475651 -0.55984933756213429 -0.54805217222840108 -0.43510052182329828;-1.8193556647452898 -0.10623290787298799 -0.056958606940481105 1.1131018689862793 0.1372805959149197 -0.97219468032797551 -0.70810932387385006;0.30419508075302704 1.0220943821224022 -0.86835352644823105 -0.28308811961003116 0.97484035160506477 0.0015914958213705166 0.73173331389506557;-0.89827959910294175 -0.46451827829899289 0.65388155848900609 -0.68550746961735931 -1.0916625332027694 -0.5509435801507151 -0.59377030386843577;-0.92814617763329255 0.0031889157615538569 0.0055933443081504731 0.31527382912433999 1.2380541281697197 0.82431930866506076 0.7915157534854883];

% Layer 2
b2 = -0.41967661683574514;
LW2_1 = [1.9706512734256134 -0.50949812381450588 -0.73395344685183583 1.1108159806547218 2.2600107727473651 1.2030518228564124 -1.5923969181532966 0.37406031838486309 -0.2925884228130517 -0.95926663739733364];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
